<!doctype HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <link rel="shortcut icon" href="#" />
    </head>

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <!--<script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>-->
    <script src="./js/gesture-detector.js"></script>
    <script src="./js/gesture-handler.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.0.0/aframe/build/aframe-ar-nft.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const img = urlParams.get('img');

        let scale, position, src, text;
        switch(img){
            case 'braciere':
                scale='0.01 0.01 0.01';
                position='0 -0.5 0';
                src="./asset/3d/Braciere.glb";
                text='Riproduzione di braciere';
                break;
            case 'ciotola':
                scale='0.01 0.01 0.01';
                position='0 -1 0';
                src="./asset/3d/Ciotola.glb";
                text='Ciotola';
                break;
            case 'fusaiola':
                scale='0.01 0.01 0.01';
                position='0 -1 0';
                src="./asset/3d/Fusaiola.glb";
                text='Fusaiola';
                break;
            case 'piccola-ascia':
                scale='0.05 0.05 0.05';
                position='0 -0.5 0';
                src="./asset/3d/Piccola-ascia.glb";
                text='Piccola ascia';
                break;
            case 'macina':
                scale='0.25 0.25 0.25';
                position='0 -1 0';
                src="./asset/3d/Macina.glb";
                text='Macina';
                break;
            case 'oletta':
                scale='5 5 5';
                position='0 -1 0';
                src="./asset/3d/Oletta.glb";
                text='Oletta';
                break;
            case 'pugnaletto':
                scale='0.05 0.05 0.05';
                position='0 -0.5 0';
                src="./asset/3d/Pugnaletto.glb";
                text='Pugnaletto';
                break;
            case 'punta-freccia':
                scale='0.25 0.25 0.25';
                position='0 -1 0';
                src="./asset/3d/Punta-freccia.glb";
                text='Punta di Freccia';
                break;
            case 'rasciatoio':
                scale='5 5 5';
                position='0 -1 0';
                src="./asset/3d/Raschiatoio.glb";
                text='Fusaiola';
                break;
            case 'tazza':
                scale='0.05 0.05 0.05';
                position='0 -0.5 0';
                src="./asset/3d/Tazza.glb";
                text='Riproduzione di tazza';
                break;
            case 'ugello':
                scale='0.05 0.05 0.05';
                position='0 -0.5 0';
                src="./asset/3d/Ugello.glb";
                text='Ugello';
                break;
            case 'vaso-miniaturistico':
                scale='0.05 0.05 0.05';
                position='0 -0.5 0';
                src="./asset/3d/Vaso-miniaturistico.glb";
                text='Vaso miniaturistico';
                break;
            }

        document.addEventListener("DOMContentLoaded", function(event) { 
            const m = document.getElementById("marker");
            m.innerHTML = m.innerHTML+` <a-entity gltf-model=${src} move position="${position}" rotation="-45 0 0" scale="${scale}" class="clickable" gesture-handler id="3Dmodel"></a-entity>`;
            document.getElementById("textAR").setAttribute('value', text);
        });
    </script>

    <body>
        <h1 class="white">Inquadra il marker con la scritta Hiro</h1>
        <a-scene embedded arjs='debugUIEnabled: false;' vr-mode-ui="enabled: false"  gesture-detector id="scene">

            <a-marker preset="hiro" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;" 
            smoothCount=0 smoothTolerance=0.0001 id='marker'>

                <a-text rotation="-45 0 0" position="-0 0 -1" width="1.8"  letter-spacing="4.8" line-height="50"  value="123" negate="false" id="textAR" 
                font="./asset/font/SpecialElite-Regular-msdf.json" align="center"></a-text>

            </a-marker>

            <a-entity camera></a-entity>
        </a-scene>

        <button onclick="history.back()" class="back btn ar3D">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-reply" viewBox="0 0 16 16">
                <path d="M5.921 11.9 1.353 8.62a.719.719 0 0 1 0-1.238L5.921 4.1A.716.716 0 0 1 7 4.719V6c1.5 0 6 0 7 8-2.5-4.5-7-4-7-4v1.281c0 .56-.606.898-1.079.62z"/>
          </svg>
            Back
        </button>

        <fieldset class='glass'>
            <legend>Interagisci con il reperto</legend>
            <div> <img src='./asset/move.gif' width=45 > <p>Usa un dito per ruotare</p> </div>
            <div> <img src='./asset/zoom.gif' width=50 > <p>Usa due dita per zoomare</p></div>
          </fieldset>
    </body>
</html>
